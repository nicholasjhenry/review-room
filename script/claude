#!/bin/bash
set -e

echo "=> Claude Code on the Web Setup..." >&2

cd "$(dirname "$0")/.."

echo "=> Installing mise..." >&2

# Install mise if not present
if ! command -v mise &>/dev/null; then
    curl https://mise.run | sh
    export PATH="$HOME/.local/bin:$PATH"
fi

echo "=> Installing tools..." >&2

# Install tools from .mise.toml or .tool-versions
mise install

# Persist PATH for subsequent commands
echo "export PATH=\"$HOME/.local/bin:\$PATH\"" >>"$CLAUDE_ENV_FILE"
echo "eval \"\$(mise activate bash)\"" >>"$CLAUDE_ENV_FILE"

echo "=> Copy env..." >&2
cp .env.template .env 2>/dev/null || true

echo "=> Run setup script..." >&2
script/setup
