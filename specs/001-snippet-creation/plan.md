# Implementation Plan: Snippet Creation

**Branch**: `001-snippet-creation` | **Date**: 2025-11-13 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-snippet-creation/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Enable developers to create, organize, and share code snippets with syntax highlighting, tagging, and privacy controls. The feature provides a Phoenix LiveView interface for snippet creation with real-time validation, Ecto-backed persistence, and support for multiple programming languages.

## Technical Context

**Language/Version**: Elixir ~> 1.15  
**Primary Dependencies**: Phoenix ~> 1.8.1, Phoenix LiveView ~> 1.1.0, Ecto SQL ~> 3.13  
**Storage**: PostgreSQL (via Ecto)  
**Target Platform**: Web application (server-rendered with LiveView)  
**Project Type**: Web application (Phoenix monolith with authentication)  
**Performance Goals**: Handle 100 concurrent snippet creation requests, <1s syntax highlighting render, <2s tag filtering for 1000 snippets  
**Constraints**: 500KB max snippet size, <5s database save timeout, XSS prevention required  
**Scale/Scope**: Multi-user snippet management with public/private/unlisted visibility controls
**Syntax Highlighting**: ✅ RESOLVED - Autumn (Elixir-native, server-side with Tree-sitter, see research.md)  
**Tag UI Pattern**: ✅ RESOLVED - Comma-separated input with normalization (see research.md)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- [x] Tests-first plan documented: Spec includes comprehensive unit tests (15 tests) and integration tests (9 tests) covering snippet creation, validation, visibility enforcement, tag filtering, and LiveView interactions. All tests will be written to fail before implementation.
- [x] Cross-boundary interactions enumerated: Database persistence (Ecto), LiveView <-> Snippets context, syntax highlighting library integration, tags as PostgreSQL array column, authentication/authorization via current_scope. Integration tests specified for each pathway.
- [x] Dependencies documented: Autumn syntax highlighting library (Elixir-native, server-side Tree-sitter), Ecto schema for Snippet with PostgreSQL array column for tags, Phoenix LiveView components. Configuration: max snippet size (500KB), supported languages list, default visibility (private), Autumn theme selection.
- [x] Failure handling strategy: Validation failures (user feedback), database timeouts (5s), syntax highlighting load failures (circuit breaker after 3 failures, degrade to plain text), unauthorized access logging, oversized content prevention. All documented in spec Failure Modes section.
- [x] Demo data planned: Will add sample snippets with various languages, tags, and visibility settings to priv/repo/seeds.exs for manual testing and demonstration purposes.

## Project Structure

### Documentation (this feature)

```text
specs/[###-feature]/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command)
├── data-model.md        # Phase 1 output (/speckit.plan command)
├── quickstart.md        # Phase 1 output (/speckit.plan command)
├── contracts/           # Phase 1 output (/speckit.plan command)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
lib/
├── review_room/
│   ├── accounts/        # Existing - user authentication
│   │   └── scope.ex     # Authorization context
│   └── snippets/        # NEW - snippet management context
│       └── snippet.ex   # Ecto schema (with tags array)
│
├── review_room_web/
│   ├── components/
│   │   └── layouts/     # Existing
│   ├── controllers/
│   │   └── snippet_controller.ex  # NEW - public snippet viewing
│   └── live/
│       ├── user_live/   # Existing - authenticated user features
│       └── snippet_live/  # NEW - snippet CRUD LiveViews
│           ├── index.ex    # List snippets
│           ├── show.ex     # View snippet
│           ├── form.ex     # Create/edit snippet
│           └── form_component.ex  # Shared form component
│
├── priv/
│   ├── repo/
│   │   ├── migrations/
│   │   │   └── YYYYMMDDHHMMSS_create_snippets.exs  # NEW - includes tags array
│   │   └── seeds.exs    # Update with demo snippets
│   └── static/
│       └── themes/      # NEW - Autumn theme CSS files
│           └── [theme-name].css  # Generated by mix autumn.gen.theme

test/
├── review_room/
│   └── snippets_test.exs     # NEW - context unit tests
├── review_room_web/
│   └── live/
│       └── snippet_live_test.exs  # NEW - LiveView integration tests
└── support/
    └── fixtures/
        └── snippets_fixtures.ex  # NEW - test data helpers
```

**Structure Decision**: Phoenix monolith web application with contexts. Following existing ReviewRoom patterns with `lib/review_room/` for business logic contexts and `lib/review_room_web/` for web interface. New `Snippets` context will be created alongside existing `Accounts` context. LiveView used for interactive UI with real-time validation. Autumn (Elixir library) provides server-side syntax highlighting, eliminating need for JavaScript hooks. Tags stored as PostgreSQL array column, eliminating need for separate tags and join tables.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

**Status**: ✅ No violations - all Constitution requirements met.

## Post-Design Constitution Re-Check

*Re-evaluated after Phase 1 design completion*

- [x] **Tests-first plan remains valid**: Design artifacts (data-model.md, contracts/) confirm all planned tests are achievable. No new untestable requirements introduced.
- [x] **Cross-boundary interactions remain explicit**: Data model confirms Ecto schemas, LiveView contracts define all events and authorization patterns, syntax highlighting hook isolated.
- [x] **No hidden dependencies introduced**: Design uses only declared dependencies (Phoenix LiveView, Ecto, Highlight.js CDN). Configuration explicit in research.md.
- [x] **Failure handling remains comprehensive**: LiveView contracts specify validation errors, authorization errors, not-found errors. Data model includes proper constraints.
- [x] **Demo data plan remains viable**: Seeds can create users, snippets with all fields, tags, and various visibility settings using fixtures defined in quickstart.md.

**Design Phase Result**: ✅ All Constitution requirements satisfied. Ready to proceed to task generation (`/speckit.tasks`).
